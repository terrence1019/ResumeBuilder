<!--


  Understanding State and Statelessness:
  https://www.c-sharpcorner.com/UploadFile/de41d6/view-state-vs-session-state-vs-application-state/

  In order to use State Preservation, Blazor can be used
  https://docs.microsoft.com/en-us/aspnet/core/blazor/components/prerendering-and-integration?view=aspnetcore-3.1&pivots=server








-->
<!-- JQUERY SCRIPT -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/scripts/jquery-3.1.1.min.js"></script>







@model RésuméBuilder.ViewModels.SkillsViewModel


@using System.Web.UI



@{
    ViewBag.Title = "AddSkillsPageView";

    //This value correlates to the ApplicantID between the Applicant and Personal Models
    var id = ViewBag.TargetID;


    //Target counter for extra rows (dynamic rows)
    var xtra = 0;


    //int k = 3;


    var x = Convert.ToInt32(Session["counter"]);

    



}

<h3></h3>


<h2>AddSkillsPageView</h2>

<h3>Add Skill Details for Registration ID @id</h3>

<p>Use the Form Below: </p>

<!--

    The aim is to add a list of Skill Points in one submission, i.e.,
    ADD A BATCH OF THE SAME ITEMS TO THE DATABASE VIA FORM SUBMISSION AND EF

    Options:
    1) Pre-configured list of items to add (e.g., 7 items per submission)
    2) Dynamic add button, to add more Skill Points as needed (e.g., 1 item initially but add button available)




    A list will be needed: IEnumerable<RésuméBuilder.Models.Skill> needs to be used?

    Result:
    - A form with a list of Skill Points, with the same Skill Category,
    and with dynamic add button
    - Submit will add all entries to the Skills Table


    Controller Action will need to accept a batch of Skill Entries

    public ActionResult AddSkillsFormAction(IEnumerable<Skills> skills)


-->






@{

    //LAST TWO THINGS:
    //Refresh Partial View every X-seconds
    //Use a server-side variable from Partial View in Main View
    //Rather than use a Global Counter, add a Counter to Model and use to increment


}







@using (Html.BeginForm("AddSkillsFormAction", "Skills", FormMethod.Post))
{

    <!-- APPLICANT ID: AUTOMATICALLY SET TO SPECIFIC VALUE -->
    <!-- This input field will be passed with the rest of the form data
         it ensures consistency of ApplicantID between Applicant and Personal.
         Hidden in a <div> to prevent accidental changes or tampering
    -->
    <div hidden>
        <input name="applicantID" type="number" value="@id" />
    </div>







    //MODEL BINDING COLLECTIONS OF COMPLEX DATATYPES:
    //https://www.learnrazorpages.com/razor-pages/model-binding#binding-simple-collections
    //http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx/
    //http://www.hanselman.com/blog/aspnet-wire-format-for-model-binding-to-arrays-lists-collections-dictionaries
    //https://stackoverflow.com/questions/40681707/mvc-model-binding-with-dynamic-collection
    //https://docs.microsoft.com/en-us/archive/msdn-magazine/2012/february/asp-net-mvc-the-features-and-foibles-of-asp-net-mvc-model-binding

    //SKILL RECORD 1 TO BE ADDED IN BATCH, STARTS AT INDEX 0: [0]
    <div class="form-group">
        @Html.LabelFor(s => s.SkillBatch[0].SkillCategory)
        @Html.TextBoxFor(s => s.SkillBatch[0].SkillCategory, new { @class = "form-control" })

        @Html.LabelFor(s => s.SkillBatch[0].SkillPoint)
        @Html.TextBoxFor(s => s.SkillBatch[0].SkillPoint, new { @class = "form-control" })

    </div>
    <br />

    //ADD MORE COLUMNS

    /*

        What I want is to be able to add more input fields dynamically, based on user needs.
        When they Click the [ADD SKILL] button, a new field is generated with required input
        I also need a counter to keep track of SkillBatch[i].
        It needs to increment after each input field is dynamically added

    */


    @Html.Partial("_AddSkillRow")





    <br />
    <br />
    <br />




    //SOLUTION: Razor Syntax to call function once event triggered (onclick)
    //razor syntax call function onclick
    //session variables
    //increment session variable
    //https://stackoverflow.com/questions/61846815/how-to-add-a-event-to-a-button-using-razor
    //https://www.c-sharpcorner.com/article/event-handling-in-blazor/
    //GOOD:
    //https://stackoverflow.com/questions/61846815/how-to-add-a-event-to-a-button-using-razor


    <br />

    //I need an MVC Razor Session Variable that increments onclick and preserves state:
    //https://stackoverflow.com/questions/14138872/how-to-use-sessions-in-an-asp-net-mvc-4-application





































    <!-- ADD DYNAMIC ROWS VIA THE SCRIPT BELOW: -->



    <script type="text/javascript">


            //Use this value and append a unique id to each row created
            var rowNum = @xtra;
            //window.alert(`j is now at: ${rowNum}`);

            var rowID = ".appendme" + rowNum;
            //Show row value to class name for div via String Interpolation
            //window.alert(`Row ID = ${rowID}`);

            //FORM DATA FOR EACH ROW STARTS HERE ==








            //FORM DATA FOR EACH ROW ENDS HERE ===









            //var strTestOpen = `<button class="removeme" id="${rowID}" type="button" onclick="RemoveRow(this)">
                //REMOVE SKILL!</button>`;






    </script>



    //HIDDEN INPUT FIELD USED TO SET SESSION COUNTER

    <div hidden>
        <input id="SessionCounter" type="number" runat="server" />
    </div>





















    <script type="text/javascript">
            //ADD A SINGLE SKILL ROW
        $(".appendbtn").click(function () {


            //How can we assign server-side C# razor variable with a client-side JS value?
            //https://stackoverflow.com/questions/22495205/access-javascript-variable-inside-razor




            //MAINTAINING A GLOBAL COUNTER & SESSION STATE
            //https://imar.spaanjaars.com/227/howto-create-a-hit-counter-using-a-text-file-in-aspnet-1x
            //https://stackoverflow.com/questions/59126869/can-the-state-of-the-counter-in-the-example-blazor-project-be-preserved-between
            //https://social.msdn.microsoft.com/Forums/en-US/4a7f1180-4e31-4023-b073-8b777d48f764/global-variable-counter?forum=aspstatemanagement
            //https://www.dotnetperls.com/static
            //https://docs.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-6.0//
            //https://hoven.in/aspnet-core/using-session.html
            //https://www.c-sharpcorner.com/UploadFile/225740/what-is-view-state-and-how-it-works-in-Asp-Net53/




            //http://www.dotnetodyssey.com/2015/01/05/getset-value-session-variable-using-javascriptjquery/







                        var str0 = '@Html.Hidden("Index", @x)'

                        //Operations to perform when skillRow is appended
                        var str1 = '<div class="form-group">';
                        var str2 = '@Html.LabelFor(s => s.SkillBatch[x].SkillCategory)';
                        var str3 = '@Html.TextBoxFor(s => s.SkillBatch[x].SkillCategory, new { @class = "form-control" })';
                        var str4 = '@Html.LabelFor(s => s.SkillBatch[x].SkillPoint)';
                        var str5 = '@Html.TextBoxFor(s => s.SkillBatch[x].SkillPoint, new { @class = "form-control" })';
                        var str6 = '</div>';





                        var strFormOpen =
                            `<div class="removeme" id="${rowID}">
                <button type="button"  onclick="RemoveRow(this)" >REMOVE SKILL BELOW:</button>`;

            var strFormClose = '<br /></div>';





                //https://stackoverflow.com/questions/41564413/string-interpolation-for-dynamic-html-attributes
                //var a = rowNum;
                //var b = "form-control";
                //var strX2 = "@@Html.TextBoxFor(s => s.SkillBatch" + rowNum + ".SkillPoint, new { @@class = "+b+" })";




                //https://gomakethings.com/converting-a-string-into-markup-with-vanilla-js/
                //var parser = new DOMParser();
                //var strX3 = ;
                //var skillRowZ = parser.parseFromString(strX2, 'text/html');





                //Concatenate strings into full HTML form
                //var strCompilation = strFormOpen + strTestParagraph + strFormClose;
                var skillRow =
                    strFormOpen + str0 +
                    str1 + str2 + str3 + str4 + str5 + str6
                    + strFormClose;








            var classID = ".appendme";
            $(classID).append(skillRow);


            rowNum++;
            //window.alert(rowNum);

            rowID = ".appendme" + rowNum;
                //window.alert(rowID);





                //BOTH APPROACHES DO THE SAME THING:
                //SET THE FIELD VALUE BASED ON A JS VALUE
                $("#SessionCounter").val(rowNum);
                //document.getElementById("SessionCounter").value = rowNum;




                //https://www.c-sharpcorner.com/UploadFile/0c1bb2/inserting-data-using-ajax/
                //https://docs.microsoft.com/en-us/answers/questions/701086/ajax-post-request-with-razor-pages-and-full-calend.html
                //https://www.c-sharpcorner.com/article/how-to-post-data-in-asp-net-core-using-ajax/
            //https://www.compilemode.com/2021/04/post-data-to-controller-using-jquery-ajax-in-asp-net-mvc.html

            SendCounter();


        }//end function



        ); //End Trigger



        //add SendCounter()

        function SendCounter(){


            var count = $("#SessionCounter").val();

            //Convert to Integer:
            var countInt = parseInt(count);



            window.alert('Sending new Counter value for Session["counter"] to Controller: '+countInt);




            //AJAX START
            $.ajax({

                type: 'POST',
                url: '@Url.Action("GetCounterValue")',
                data: { SessionCounter : countInt },



            })//end ajax




            //AJAX STOP


        }//SendCounter()

    </script>



    //HIDDEN FIELD, BUTTON, AND SCRIPT TO TEST AJAX TO CONTROLLER

    //<input name="SessionCounter" id="SessionCounterTest" type="number" runat="server" value=@k />
    <br />

    //DIAGNOSTIC TESTING

    <div hidden>

        <h4>Counter Retrieved</h4>

        <input name="CounterRetrieved" id="MyCounter" type="number" runat="server" />

        <button type="button" id="btnAlert">[SEND MY COUNTER!]</button>

    </div>

    //PROBLEM HELPERS:
    //http://www.codedigest.com/posts/35/adding-javascript-in-aspnet-mvc-views
    //https://www.youtube.com/watch?v=7ai2-TMQRek&t=306s&ab_channel=WebGentle
    //https://www.c-sharpcorner.com/article/asp-net-mvc-how-to-use-ajax-with-parameters/
    //https://stackoverflow.com/questions/48688756/ajax-post-int-to-mvc



    <script type="text/javascript">

        //FUNCTION 1: Activity Trigger on Button Click using jQuery
        $("#btnAlert").click(


            function BtnClick() {

            window.alert("TEST BtnClick()");

                var count = $("#SessionCounter").val();

                //Convert to Integer:
                var countInt = parseInt(count);

                //Object will be:
                var obj = { SessionCounter : countInt };

                TestMsg(countInt);
                SendCounterTest();
                GetCounter();

            }//BtnClick()


        );//JQuery Event: Click Button with specified ID

        function TestMsg(countInt) {

            window.alert("Test for BtnClick() using TestMsg() " + countInt);

        }//TestMsg()

        function SendCounterTest(){


            var count = $("#SessionCounter").val();

            //Convert to Integer:
            var countInt = parseInt(count);



            window.alert("Sending Counter to Controller: "+countInt);




            //AJAX START
            $.ajax({

                type: 'POST',
                url: '@Url.Action("GetCounterValue")',
                data: { SessionCounter : countInt },


                success: function Success() {
                    window.alert("Data successfully sent to Controller!");
                },

                error: function ErrorAlert() {
                    window.alert("ERROR");
                }


            })//end ajax




            //AJAX STOP


        }//SendCounter()


        //GetCounter
        //https://stackoverflow.com/questions/24851926/refresh-session-variable-after-a-update-in-mvc4
        //https://stackoverflow.com/questions/59932436/how-can-i-update-session-values-without-refreshing-my-page-in-asp-net-mvc
        //https://stackoverflow.com/questions/43831192/how-to-receive-ajax-data-values-from-controller-in-asp-mvc
        //https://stackoverflow.com/questions/5396282/auto-refresh-in-asp-net-mvc
        //https://stackoverflow.com/questions/17886578/refresh-part-of-page-div
        //https://www.sensibledev.com/jquery-ajax-call-to-mvc-controller-with-parameters/

        //FUNCTION:
        //Use notes from this excellent source: https://www.sensibledev.com/jquery-ajax-call-to-mvc-controller-with-parameters/
        function GetCounter() {

            window.alert("Getting Counter from Controller:");

            var url = '@Url.Action("CounterRefresh")';


            $.get(url, function (data)
            {
                window.alert(data);
                var curr_counter = data;



                window.alert("Counter to add: " + curr_counter);
                $("#MyCounter").val(curr_counter);
            });



        }//GetCounter()


    </script>




    /*

    //Awesome work: //https://www.sensibledev.com/jquery-ajax-call-to-mvc-controller-with-parameters/

    <button id="btnHowMuch" >[HOW MUCH?]</button>

    <script>

        function getAmount() {
            var url = '@Url.Action("GetAmount")';


            $.get(url, function (data) {
                //$("#swearJar").html('$' + data);
                window.alert(data);
            });
        }

        $("#btnHowMuch").on("click", getAmount);

    </script>
    */





    <script type="text/javascript">

        //REMOVE A SINGLE SKILL ROW
        function RemoveRow(elem) {


            elem.parentElement.remove();
            window.alert("Row ID to be deleted: " + rowID);


            //DECREMENT ROW
            rowNum--;
            rowID = ".appendme" + rowNum;



        }

    </script>


    <script type="text/javascript">

        //REMOVE ALL EXTRA SKILL ROWS ADDED
        $(".removebtn").click(function () {

            classID = ".removeme";

            window.alert("Final Row ID to be removed: " + rowID);

            $(classID).remove();

            //Reset counter for extra rows to zero,
            //So when adding new rows, it will increment to 1 -> [1]
            rowNum = 0;
            window.alert("ALL Skill Rows removed. Row No. counter is now at " + rowNum);




        });



    </script>









    <!-- THIS IS WHERE A NEWLY CREATED ROW WILL APPEAR-->
    <div class="appendme"></div>








    <br />





    


    <!-- FORM DATA SUBMISSION -->

    <input type="submit" class="btn btn-primary" value="Add Batch of Skill Records">




}<!-- End of Code Block-->



@{

    //RENDER PARTIAL VIEW USING CONTROLLER METHOD AND JQUERY/AJAX
    //https://stackoverflow.com/questions/28181337/how-can-i-send-a-parameter-to-partial-view-without-the-need-of-a-model
    //https://dotnettutorials.net/lesson/different-ways-to-render-partial-view-in-mvc/
    //https://stackoverflow.com/questions/49363380/can-not-call-partialview-with-parameter-in-mvc
    //https://stackoverflow.com/questions/39006221/passing-parameters-to-partial-views
    //https://stackoverflow.com/questions/18355099/mvc-partial-view-with-int-model-throws-exception
    //https://geeksarray.com/blog/render-partialview-with-model
    //https://geeksarray.com/blog/how-to-use-partial-view-in-mvc-with-example
    //https://docs.microsoft.com/en-us/answers/questions/750305/need-help-on-partial-view-using-jquery-ajax.html
    //https://stackoverflow.com/questions/1570127/render-partial-view-using-jquery-in-asp-net-mvc#:~:text=You%20can't%20render%20a,the%20page%20using%20jQuery%2FAJAX.
    //https://www.aspsnippets.com/Articles/Load-Render-Partial-View-in-DIV-using-AJAX-in-ASPNet-MVC.aspx


    //https://www.google.com/search?q=asp+mvc+controller+return+partialview+with+integer&sxsrf=ALiCzsbzR3AltRo8TMZ3zlnPrb8BqxmhFw%3A1653731402018&ei=SvCRYohiqd6S9A-OqJ_wCA&ved=0ahUKEwiIr5XG9YH4AhUpr4QIHQ7UB44Q4dUDCA4&uact=5&oq=asp+mvc+controller+return+partialview+with+integer&gs_lcp=Cgdnd3Mtd2l6EAM6BAgjECc6BAghEApKBAhBGAFKBAhGGABQ6AhYzRRg6xVoAXAAeACAAYQBiAGvCpIBBDAuMTGYAQCgAQHAAQE&sclient=gws-wiz
    //https://www.google.com/search?q=Render+Partial+View+Using+jQuery+load&sxsrf=ALiCzsaEs6lHrS2mIv7hIZ7KC97sJbmFCw%3A1653731912733&ei=SPKRYpuwLIa_kvQPssaG4AQ&ved=0ahUKEwib9Ni594H4AhWGn4QIHTKjAUwQ4dUDCA4&uact=5&oq=Render+Partial+View+Using+jQuery+load&gs_lcp=Cgdnd3Mtd2l6EAMyBQghEKABMgUIIRCgATIICCEQHhAWEB0yCAghEB4QFhAdOgcIABBHELADOgUIABCABDoGCAAQHhAWOgQIIRAVSgQIQRgASgQIRhgAULAFWPIKYK8UaAFwAXgAgAGdAYgBgQWSAQMwLjWYAQCgAQHIAQjAAQE&sclient=gws-wiz


    //ALL ABOUT PARTIAL VIEWS
    //https://docs.microsoft.com/en-us/aspnet/core/mvc/views/partial?view=aspnetcore-6.0
    //https://geeksarray.com/blog/how-to-use-partial-view-in-mvc-with-example

}




<!--


DIAGNOSTIC TESTING

RENDERING PARTIALVIEW WITH CONTROLLER AND JQUERY/AJAX
SOLUTION: https://geeksarray.com/blog/how-to-use-partial-view-in-mvc-with-example

ENABLING AUTOREFRESH/AUTORELOAD
SOLUTION: https://www.quizcure.com/jquery/jquery-refresh-div-ajax-click-interval

-->
<div id="partialviews">

</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


<script>
    $(document).ready(function () {

        function loadPartialCount() {
            $('#partialviews').load('/Skills/ReturnPartial');
        }

        setInterval(function () {
            loadPartialCount()
        }, 10); //1000 = 1 second
    });

</script>


<div id="partialviews2">

</div>

<script>
    //Each change to the AddSkillsViewPage View will "reload" the _SkillRowCreate PartialView
    $(".appendbtn").click(function () {

        function loadPartialCreate() {

            $('#partialviews2').load('/Skills/ReturnPartial2');
        }

        //SOLUTION: https://www.w3schools.com/jsref/met_win_settimeout.asp
        setTimeout(function () {
            loadPartialCreate()
        }, 10); //1000 = 1 second

    });

</script>


<!--
    FINALE!


    On Clicking Add Row Button, a new <div> with Row using the current Session["counter"]
    is added within the Form



    Click Add HTML Element:
    https://stackoverflow.com/questions/21732340/using-javascript-to-create-a-div-onclick

-->
<!--

    FINAL GOALS:
    1) Get correct Controller Variables into PartialView [Controller -> PartialView]
    2) Pass PartialView Razor Variables to Main View -> Counter [PartialView -> View]
    3) Use Counter to increment number of Skill Rows



-->
<!-- DIAGNOSTIC TESTING -->

<div hidden>

    <h1>COUNTER FOR SKILL ROWS [VIEW]</h1>
    <p>Globals.j = @Globals.j</p>
    <p>Globals.i = @Globals.i</p>
    <p>TempData["counter"] = @TempData["counter"]</p>
    <p>Session["counter"] = @Session["counter"]</p>
    <p>ViewBag.Counter = @ViewBag.Counter</p>
    <p>ViewBag.Counter = @ViewBag.Counter</p>

</div>







<!-- END OF VIEW

https://docs.microsoft.com/en-us/aspnet/core/mvc/views/working-with-forms?view=aspnetcore-6.0







-->
